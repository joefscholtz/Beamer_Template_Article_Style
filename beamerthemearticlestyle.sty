\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamertheme}[2025/12/12 Custom Beamer Theme]

\RequirePackage{tikz}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{shapes.misc}
\RequirePackage{microtype}
\RequirePackage{etoolbox}
\RequirePackage[T1]{fontenc}
\RequirePackage{sourcesanspro} 

\mode<presentation>

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Colors
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Primary Brand Colors
\definecolor{cardinalred}{RGB}{140,21,21} 
\definecolor{coolgrey}{RGB}{77,79,83} 
\definecolor{lightgrey}{HTML}{f8f8f8} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Beamer General Settings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Itemize Bullet Colors
\setbeamercolor{itemize item}{fg=black}
\setbeamercolor{itemize subitem}{fg=black}
\setbeamercolor{itemize subsubitem}{fg=black}
\setbeamercolor{section head}{fg=cardinalred}

% Itemize Bullet Shapes
\setbeamertemplate{itemize item}[circle]
\setbeamertemplate{itemize subitem}{{\textendash}}
\setbeamertemplate{itemize subsubitem}[triangle]

% Font Settings
\setbeamerfont{subtitle}{series=\scshape}
\setbeamercolor{subtitle}{fg=black}
\setbeamerfont{author}{family=\sourcesanspro}
\setbeamercolor{author}{fg=black}

\setbeamerfont{institute}{family=\sourcesanspro}
\setbeamercolor{institute}{fg=cardinalred}

\setbeamerfont{email}{family=\sourcesanspro}
\setbeamercolor{email}{fg=coolgrey}

\setbeamerfont{date}{family=\sourcesanspro}
\setbeamercolor{date}{fg=white}

\setbeamerfont{frametitle}{series=\scshape}
\setbeamercolor{frametitle}{fg=black}

% Email handling
% Initialize @email to avoid errors if user doesn't define it
\def\@email{} 
\newcommand{\email}[1]{\def\@email{\texttt{\MakeLowercase{\textls[10]{#1}}}}}

% Navigation Symbols (Adding page numbers)
\addtobeamertemplate{navigation symbols}{}{%
    \usebeamerfont{footline}%
    \usebeamercolor[fg]{footline}%
    \hspace{1em}%
    \insertframenumber/\inserttotalframenumber
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title Page
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newtoggle{showInstituteLogo}
\togglefalse{showInstituteLogo} 

\newcommand{\instituteLogo}{} 
\newcommand{\instituteThumb}{} 

\newcommand{\useInstituteLogo}[1]{%
  \toggletrue{showInstituteLogo}
  \renewcommand{\instituteLogo}{#1}%
}

\newcommand{\useInstituteThumb}[1]{%
  \renewcommand{\instituteThumb}{#1}%
}

\setbeamertemplate{title page}[default][left] 

% Custom Title Page Template
\defbeamertemplate*{title page}{customized}[1][]
{
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (CircleCenter) at ([xshift=0, yshift=0cm]current page.center);
        
        % [fill=colorname!alpha]
        \fill[fill=coolgrey!10] (CircleCenter) circle (8cm);
        
        \fill[fill=white] (CircleCenter) circle (6cm);
    \end{tikzpicture}
    
    \vspace{-1.2cm}
    \centering{
      \iftoggle{showInstituteLogo}{
        % If toggle is TRUE, show the image
        % \insertinstitute now holds the image path provided by the user
        \begin{figure}
             \includegraphics[height=2cm]{\instituteLogo} % Adjust height as needed
        \end{figure}
      }{
        % If toggle is FALSE, show the text (Standard behavior)
        \usebeamerfont{institute}{\usebeamercolor[fg]{institute}\textls[100]{\textsc{\insertinstitute}}}\par
      }
      \bigskip
      \usebeamerfont{title}\textls[100]{\MakeUppercase{\textbf{\inserttitle}}}\par
      \usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\textls[100]{\textsc{\insertsubtitle}}\par\par
    }
    \vfill
    \usebeamerfont{author}\usebeamercolor[fg]{author}\textls[100]{\textsc{\insertauthor}}\par
    \smallskip
    {\usebeamercolor[fg]{email}\@email}\par
    \vfill
    \begin{figure}
      \centering
      \begin{tikzpicture}
        \node[fill=cardinalred, rounded rectangle, minimum width=1.1cm, minimum height=0.6cm] at (0, 0) {\footnotesize{\textbf{\usebeamercolor[fg]{date}{\usebeamerfont{date}{\insertdate}}}}};
      \end{tikzpicture}
    \end{figure}
    \vspace{-1cm}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Table of contents
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\def\@toctittle{Table of Contents}
\newcommand{\toctittle}[1]{
  \def\@toctittle{#1}
}
\newcommand{\inserttoctittle}{
    \@toctittle
}

% style of section presented in the table of contents
\setbeamertemplate{section in toc}{%
  \tikz{\draw[fill=black] (0,0) circle (3pt);}
  \hspace{1mm}{\usebeamerfont{subtitle}\usebeamercolor[fg]{frametitle}{\textsc{\textbf{\inserttocsection}}}}\par%

}
\setbeamertemplate{subsection in toc}{%
  \tikz{\draw[fill=blue!20] (0,0) circle (3pt);}\hspace{2mm}\inserttocsection\par
}


% avoid numbering of frames that are breaked into multiply slides
\setbeamertemplate{frametitle continuation}{}

\newcommand{\InsertTocFrame}{
        \begin{frame}
              \begin{tikzpicture}[remember picture, overlay]
                \coordinate (CircleCenter) at ([xshift=-8cm, yshift=0cm]current page.center);
                
                % Outer Grey Circle
                \fill[fill=coolgrey!10] (CircleCenter) circle (8cm);
                
                % Inner White Circle
                \fill[fill=white] (CircleCenter) circle (6cm);
            \end{tikzpicture}

            \begin{minipage}[t]{0.6\textwidth}
              \vfill
              \begin{figure}
                  \includegraphics[height=2cm]{\instituteLogo}
              \end{figure}


              aaa
            \end{minipage}
            \begin{minipage}[t]{0.38\textwidth}
              \tableofcontents
            \end{minipage}
        \end{frame}
    }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Frame Title 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setbeamertemplate{frametitle}{   
    \vspace*{-2mm}
    \begin{center}
        \footnotesize
        \inserttitle
    \end{center}
    \vspace*{-2mm}
    \begin{minipage}[t]{0.5\textwidth}
      % Logic to handle section vs frame titles
      \ifdefempty{\insertsectionhead}{%
          \ifdefempty{\insertframetitle}{}{%
              \textbf{-- }\insertframetitle
          }%
      }{%
          \ifdefempty{\insertframetitle}{}{%
            \textbf{\large{\insertframetitle}}

            \vspace{-2mm}
            \textcolor{cardinalred}{\normalsize{\insertsectionhead}}
          }%
      }
    \end{minipage}
    \begin{minipage}[t]{0.48\textwidth}
      \vspace{-1.25cm}
      \begin{figure}
        \begin{flushright}
          \includegraphics[height=1.2cm]{\instituteThumb}
        \end{flushright}
      \end{figure}
    \end{minipage}

}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Section Divider Slides
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\AtBeginSection[]{
  \begin{frame}
    \begin{tikzpicture}[remember picture, overlay]
      \coordinate (CircleCenter) at ([xshift=0, yshift=0cm]current page.center);
      
      % [fill=colorname!alpha]
      \fill[fill=coolgrey!10] (CircleCenter) circle (8cm);
      
      \fill[fill=white] (CircleCenter) circle (6cm);
    \end{tikzpicture}
  \vfill
  \centering
  \begin{beamercolorbox}[sep=8pt,center]{title}
    {\usebeamerfont{title}\usebeamercolor[fg]{frametitle}{\textsc{\insertsectionnumber\protect~\text{.}\insertsectionhead}}}\par%
  \end{beamercolorbox}
  \vfill
  \end{frame}
}

\mode<all>

